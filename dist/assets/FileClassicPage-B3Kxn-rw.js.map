{"version":3,"file":"FileClassicPage-B3Kxn-rw.js","sources":["../../src/views/FileClassicPage.vue"],"sourcesContent":["<template>\r\n  <div class=\"file-page\">\r\n    <h2>文件加密/解密(兼容版)</h2>\r\n    \r\n    <div class=\"input-section\">\r\n      <input type=\"file\" ref=\"fileInput\" @change=\"handleFileChange\">\r\n      <input type=\"password\" v-model=\"password\" placeholder=\"输入密码\">\r\n      \r\n      <div class=\"chunk-size-group\">\r\n        <div class=\"chunk-size-header\">\r\n          <label>分块大小(MiB):</label>\r\n          <input type=\"number\" v-model.number=\"chunkSize\" min=\"1\" max=\"128\">\r\n        </div>\r\n        \r\n        <details class=\"hint-box\" open>\r\n          <summary class=\"hint-title\">分块大小建议:</summary>\r\n          <ul class=\"hint-list\">\r\n            <li><strong>大文件(32MiB)</strong>: 整体文件处理，提高性能</li>\r\n            <li><strong>视频文件(5-32MiB)</strong>: 增强随机读取性能</li>\r\n            <li><strong>一般视频(5MiB)</strong>: 适合大多数视频文件</li>\r\n            <li><strong>较大视频(16-32MiB)</strong>: 适合高清/4K视频</li>\r\n          </ul>\r\n          \r\n          <div class=\"warning-text\">\r\n            ⚠️ 注意: 分块太小会导致文件被分成过多块，可能产生大量请求次数，造成额外费用。\r\n            请根据文件类型和大小选择合适的分块大小。\r\n          </div>\r\n        </details>\r\n      </div>\r\n      \r\n      <div class=\"button-group\" style=\"margin-top: 0.5em;\">\r\n        <button @click=\"encryptFile\" :disabled=\"isLoading\">加密</button>\r\n        <button @click=\"decryptFile\" :disabled=\"isLoading\">解密</button>\r\n        <button @click=\"changePassword\" :disabled=\"isLoading\">改密</button>\r\n        <button @click=\"clearAll\" :disabled=\"isLoading\">清除</button>\r\n      </div>\r\n      \r\n      <div class=\"password-change-section\" v-if=\"showPasswordChange\">\r\n        <h3>更改密码</h3>\r\n        <input type=\"password\" v-model=\"newPassword\" placeholder=\"输入新密码\">\r\n        <div class=\"button-group\">\r\n          <button @click=\"confirmPasswordChange\" :disabled=\"isLoading\">确认更改</button>\r\n          <button @click=\"cancelPasswordChange\" :disabled=\"isLoading\">取消</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"status-section\" v-if=\"statusMessage\">\r\n      <h3>状态:</h3>\r\n      <div class=\"status-box\">{{ statusMessage }}</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { encrypt_file, decrypt_file, change_file_password } from 'simple-data-crypto/builder'\r\n\r\nexport default {\r\n  name: 'FileClassicPage',\r\n  data() {\r\n    return {\r\n      selectedFile: null,\r\n      password: '',\r\n      chunkSize: 32, // 默认32MiB\r\n      statusMessage: '',\r\n      isLoading: false,\r\n      showPasswordChange: false,\r\n      newPassword: '',\r\n      confirmPassword: ''\r\n    }\r\n  },\r\n  methods: {\r\n    handleFileChange(event) {\r\n      this.selectedFile = event.target.files[0];\r\n      if (this.selectedFile) {\r\n        this.statusMessage = `已选择文件: ${this.selectedFile.name}`;\r\n      }\r\n    },\r\n    async encryptFile() {\r\n      if (!this.selectedFile) {\r\n        this.statusMessage = '请选择文件';\r\n        return;\r\n      }\r\n      if (!this.password) {\r\n        if (!confirm('确定要使用空密码？这非常不安全！')) return;\r\n      }\r\n      \r\n      this.isLoading = true;\r\n      try {\r\n        const encryptedFileName = `${this.selectedFile.name}.enc`;\r\n        \r\n        // 传统方式保存文件\r\n        const link = document.createElement('a');\r\n        link.style.display = 'none';\r\n        document.body.appendChild(link);\r\n        \r\n        const chunkSize = this.chunkSize * 1024 * 1024;\r\n        \r\n        const chunks = [];\r\n        \r\n        await encrypt_file(\r\n          async (start, end) => {\r\n            const chunk = await this.selectedFile.slice(start, end).arrayBuffer();\r\n            return new Uint8Array(chunk);\r\n          },\r\n          (data) => {\r\n            chunks.push(data);\r\n          },\r\n          this.password,\r\n          (progress) => {\r\n            const percent = (progress / this.selectedFile.size * 100).toFixed(2);\r\n            this.statusMessage = `加密中... ${percent}%`;\r\n          },\r\n          null,\r\n          null,\r\n          chunkSize\r\n        );\r\n        \r\n        const blob = new Blob(chunks, { type: 'application/octet-stream' });\r\n        const url = URL.createObjectURL(blob);\r\n        link.href = url;\r\n        link.download = encryptedFileName;\r\n        link.click();\r\n        \r\n        URL.revokeObjectURL(url);\r\n        document.body.removeChild(link);\r\n        \r\n        this.statusMessage = `文件加密成功: ${encryptedFileName}`;\r\n      } catch (error) {\r\n        this.statusMessage = '加密失败: ' + error;\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    },\r\n    async decryptFile() {\r\n      if (!this.selectedFile) {\r\n        this.statusMessage = '请选择文件';\r\n        return;\r\n      }\r\n      \r\n      this.isLoading = true;\r\n      try {\r\n        const decryptedFileName = this.selectedFile.name.endsWith('.enc') \r\n          ? this.selectedFile.name.slice(0, -4) \r\n          : `decrypted_${this.selectedFile.name}`;\r\n          \r\n        // 传统方式保存文件\r\n        const link = document.createElement('a');\r\n        link.style.display = 'none';\r\n        document.body.appendChild(link);\r\n        \r\n        const chunks = [];\r\n        \r\n        await decrypt_file(\r\n          async (start, end) => {\r\n            const chunk = await this.selectedFile.slice(start, end).arrayBuffer();\r\n            return new Uint8Array(chunk);\r\n          },\r\n          (data) => {\r\n            chunks.push(data);\r\n          },\r\n          this.password,\r\n          (progress) => {\r\n            const percent = (progress / this.selectedFile.size * 100).toFixed(2);\r\n            this.statusMessage = `解密中... ${percent}%`;\r\n          },\r\n        );\r\n        \r\n        const blob = new Blob(chunks, { type: 'application/octet-stream' });\r\n        const url = URL.createObjectURL(blob);\r\n        link.href = url;\r\n        link.download = decryptedFileName;\r\n        link.click();\r\n        \r\n        URL.revokeObjectURL(url);\r\n        document.body.removeChild(link);\r\n        \r\n        this.statusMessage = `文件解密成功: ${decryptedFileName}`;\r\n      } catch (error) {\r\n        this.statusMessage = '解密失败: ' + error;\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    },\r\n    clearAll() {\r\n      this.$refs.fileInput.value = '';\r\n      this.selectedFile = null;\r\n      this.password = '';\r\n      this.statusMessage = '';\r\n      this.showPasswordChange = false;\r\n      this.newPassword = '';\r\n      this.confirmPassword = '';\r\n    },\r\n    \r\n    changePassword() {\r\n      if (!this.selectedFile) {\r\n        this.statusMessage = '请选择文件并输入当前密码';\r\n        return;\r\n      }\r\n      this.showPasswordChange = true;\r\n      this.newPassword = '';\r\n      this.confirmPassword = '';\r\n    },\r\n    \r\n    cancelPasswordChange() {\r\n      this.showPasswordChange = false;\r\n      this.newPassword = '';\r\n      this.confirmPassword = '';\r\n    },\r\n    \r\n    async confirmPasswordChange() {\r\n      if (!this.newPassword) {\r\n        if (!confirm('确定要使用空密码？这非常不安全！')) return;\r\n      }\r\n      \r\n      \r\n      this.isLoading = true;\r\n      try {\r\n        const blob = this.selectedFile.slice(0, 5000);\r\n        \r\n        const newFileHead = await change_file_password(blob, this.password, this.newPassword);\r\n        \r\n        // 传统方式保存修改后的文件\r\n        const link = document.createElement('a');\r\n        link.style.display = 'none';\r\n        document.body.appendChild(link);\r\n        \r\n        const url = URL.createObjectURL(new Blob([newFileHead, this.selectedFile.slice(newFileHead.size)], { type: 'application/octet-stream' }));\r\n        link.href = url;\r\n        link.download = this.selectedFile.name;\r\n        link.click();\r\n        \r\n        URL.revokeObjectURL(url);\r\n        document.body.removeChild(link);\r\n        \r\n        this.statusMessage = '密码更改成功';\r\n        this.showPasswordChange = false;\r\n        this.newPassword = '';\r\n        this.confirmPassword = '';\r\n      } catch (error) {\r\n        this.statusMessage = '密码更改失败: ' + error;\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.file-page {\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n  padding: 10px;\r\n}\r\n\r\n.input-section {\r\n  margin-bottom: 20px;\r\n}\r\n\r\ninput[type=\"file\"] {\r\n  width: 100%;\r\n  margin-bottom: 10px;\r\n}\r\n\r\ninput[type=\"password\"] {\r\n  width: 100%;\r\n  padding: 10px;\r\n  margin-bottom: 10px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 4px;\r\n}\r\n\r\n.button-group {\r\n  display: flex;\r\n  gap: 10px;\r\n}\r\n\r\nbutton {\r\n  flex: 1;\r\n  padding: 10px;\r\n  background: #2c3e50;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n}\r\n\r\nbutton:disabled {\r\n  background: #cccccc;\r\n  cursor: not-allowed;\r\n}\r\n\r\nbutton:not(:disabled):hover {\r\n  background: #1a2a3a;\r\n}\r\n\r\n.status-section {\r\n  margin-top: 20px;\r\n}\r\n\r\n.status-box {\r\n  min-height: 50px;\r\n  padding: 10px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 4px;\r\n  background: #f9f9f9;\r\n}\r\n\r\n.chunk-size-header {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.hint-box {\r\n  padding: 15px;\r\n  background: #f8f9fa;\r\n  border-radius: 6px;\r\n  border-left: 4px solid #4a89dc;\r\n}\r\n\r\n.hint-title {\r\n  font-weight: bold;\r\n  margin-bottom: 8px;\r\n  color: #2c3e50;\r\n}\r\n\r\n.hint-list {\r\n  margin: 10px 0;\r\n  padding-left: 20px;\r\n  text-align: left;\r\n}\r\n\r\n.hint-list li {\r\n  margin-bottom: 5px;\r\n  color: #555;\r\n}\r\n\r\n.warning-text {\r\n  margin-top: 10px;\r\n  padding: 10px;\r\n  background: #fff8e1;\r\n  border-radius: 4px;\r\n  color: #e65100;\r\n  font-size: 0.9em;\r\n}\r\n</style>"],"names":["_sfc_main","event","encryptedFileName","link","chunkSize","chunks","encrypt_file","start","end","chunk","data","progress","percent","blob","url","error","decryptedFileName","decrypt_file","newFileHead","change_file_password","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_15","_openBlock","_createElementBlock","_cache","_createElementVNode","$options","args","$event","$data","_createStaticVNode","_hoisted_5","_hoisted_10","_createCommentVNode","_hoisted_14","_toDisplayString"],"mappings":"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"}