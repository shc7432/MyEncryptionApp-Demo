import{c as p,a as m,b as f}from"./main.bundle.builder-C2m_JIdm.js";import{_ as y,c as r,a,b as w,w as c,v as h,d as b,t as v,o as u}from"./index-CGD7C7pN.js";const F={name:"FileClassicPage",data(){return{selectedFile:null,password:"",chunkSize:32,statusMessage:"",isLoading:!1,showPasswordChange:!1,newPassword:"",confirmPassword:""}},methods:{handleFileChange(n){this.selectedFile=n.target.files[0],this.selectedFile&&(this.statusMessage=`已选择文件: ${this.selectedFile.name}`)},async encryptFile(){if(!this.selectedFile){this.statusMessage="请选择文件";return}if(!(!this.password&&!confirm("确定要使用空密码？这非常不安全！"))){this.isLoading=!0;try{const n=`${this.selectedFile.name}.enc`,s=document.createElement("a");s.style.display="none",document.body.appendChild(s);const l=this.chunkSize*1024*1024,o=[];await f(async(e,d)=>{const g=await this.selectedFile.slice(e,d).arrayBuffer();return new Uint8Array(g)},e=>{o.push(e)},this.password,e=>{const d=(e/this.selectedFile.size*100).toFixed(2);this.statusMessage=`加密中... ${d}%`},null,null,l);const i=new Blob(o,{type:"application/octet-stream"}),t=URL.createObjectURL(i);s.href=t,s.download=n,s.click(),URL.revokeObjectURL(t),document.body.removeChild(s),this.statusMessage=`文件加密成功: ${n}`}catch(n){this.statusMessage="加密失败: "+n}finally{this.isLoading=!1}}},async decryptFile(){if(!this.selectedFile){this.statusMessage="请选择文件";return}this.isLoading=!0;try{const n=this.selectedFile.name.endsWith(".enc")?this.selectedFile.name.slice(0,-4):`decrypted_${this.selectedFile.name}`,s=document.createElement("a");s.style.display="none",document.body.appendChild(s);const l=[];await m(async(t,e)=>{const d=await this.selectedFile.slice(t,e).arrayBuffer();return new Uint8Array(d)},t=>{l.push(t)},this.password,t=>{const e=(t/this.selectedFile.size*100).toFixed(2);this.statusMessage=`解密中... ${e}%`});const o=new Blob(l,{type:"application/octet-stream"}),i=URL.createObjectURL(o);s.href=i,s.download=n,s.click(),URL.revokeObjectURL(i),document.body.removeChild(s),this.statusMessage=`文件解密成功: ${n}`}catch(n){this.statusMessage="解密失败: "+n}finally{this.isLoading=!1}},clearAll(){this.$refs.fileInput.value="",this.selectedFile=null,this.password="",this.statusMessage="",this.showPasswordChange=!1,this.newPassword="",this.confirmPassword=""},changePassword(){if(!this.selectedFile){this.statusMessage="请选择文件并输入当前密码";return}this.showPasswordChange=!0,this.newPassword="",this.confirmPassword=""},cancelPasswordChange(){this.showPasswordChange=!1,this.newPassword="",this.confirmPassword=""},async confirmPasswordChange(){if(!(!this.newPassword&&!confirm("确定要使用空密码？这非常不安全！"))){this.isLoading=!0;try{const n=this.selectedFile.slice(0,5e3),s=await p(n,this.password,this.newPassword),l=document.createElement("a");l.style.display="none",document.body.appendChild(l);const o=URL.createObjectURL(new Blob([s,this.selectedFile.slice(s.size)],{type:"application/octet-stream"}));l.href=o,l.download=this.selectedFile.name,l.click(),URL.revokeObjectURL(o),document.body.removeChild(l),this.statusMessage="密码更改成功",this.showPasswordChange=!1,this.newPassword="",this.confirmPassword=""}catch(n){this.statusMessage="密码更改失败: "+n}finally{this.isLoading=!1}}}}},C={class:"file-page"},P={class:"input-section"},k={class:"chunk-size-group"},L={class:"chunk-size-header"},M={class:"button-group",style:{"margin-top":"0.5em"}},U=["disabled"],_=["disabled"],B=["disabled"],R=["disabled"],x={key:0,class:"password-change-section"},z={class:"button-group"},S=["disabled"],j=["disabled"],O={key:0,class:"status-section"},V={class:"status-box"};function A(n,s,l,o,i,t){return u(),r("div",C,[s[14]||(s[14]=a("h2",null,"文件加密/解密(兼容版)",-1)),a("div",P,[a("input",{type:"file",ref:"fileInput",onChange:s[0]||(s[0]=(...e)=>t.handleFileChange&&t.handleFileChange(...e))},null,544),c(a("input",{autocomplete:"off",type:"password","onUpdate:modelValue":s[1]||(s[1]=e=>i.password=e),placeholder:"输入密码"},null,512),[[h,i.password]]),a("div",k,[a("div",L,[s[10]||(s[10]=a("label",null,"分块大小(MiB):",-1)),c(a("input",{type:"number","onUpdate:modelValue":s[2]||(s[2]=e=>i.chunkSize=e),min:"1",max:"128"},null,512),[[h,i.chunkSize,void 0,{number:!0}]])]),s[11]||(s[11]=b('<details class="hint-box" open data-v-1e970232><summary class="hint-title" data-v-1e970232>分块大小建议:</summary><ul class="hint-list" data-v-1e970232><li data-v-1e970232><strong data-v-1e970232>大文件(32MiB)</strong>: 整体文件处理，提高性能</li><li data-v-1e970232><strong data-v-1e970232>视频文件(5-32MiB)</strong>: 增强随机读取性能</li><li data-v-1e970232><strong data-v-1e970232>一般视频(5MiB)</strong>: 适合大多数视频文件</li><li data-v-1e970232><strong data-v-1e970232>较大视频(16-32MiB)</strong>: 适合高清/4K视频</li></ul><div class="warning-text" data-v-1e970232> ⚠️ 注意: 分块太小会导致文件被分成过多块，可能产生大量请求次数，造成额外费用。 请根据文件类型和大小选择合适的分块大小。 </div></details>',1))]),a("div",M,[a("button",{onClick:s[3]||(s[3]=(...e)=>t.encryptFile&&t.encryptFile(...e)),disabled:i.isLoading},"加密",8,U),a("button",{onClick:s[4]||(s[4]=(...e)=>t.decryptFile&&t.decryptFile(...e)),disabled:i.isLoading},"解密",8,_),a("button",{onClick:s[5]||(s[5]=(...e)=>t.changePassword&&t.changePassword(...e)),disabled:i.isLoading},"改密",8,B),a("button",{onClick:s[6]||(s[6]=(...e)=>t.clearAll&&t.clearAll(...e)),disabled:i.isLoading},"清除",8,R)]),i.showPasswordChange?(u(),r("div",x,[s[12]||(s[12]=a("h3",null,"更改密码",-1)),c(a("input",{autocomplete:"off",type:"password","onUpdate:modelValue":s[7]||(s[7]=e=>i.newPassword=e),placeholder:"输入新密码"},null,512),[[h,i.newPassword]]),a("div",z,[a("button",{onClick:s[8]||(s[8]=(...e)=>t.confirmPasswordChange&&t.confirmPasswordChange(...e)),disabled:i.isLoading},"确认更改",8,S),a("button",{onClick:s[9]||(s[9]=(...e)=>t.cancelPasswordChange&&t.cancelPasswordChange(...e)),disabled:i.isLoading},"取消",8,j)])])):w("",!0)]),i.statusMessage?(u(),r("div",O,[s[13]||(s[13]=a("h3",null,"状态:",-1)),a("div",V,v(i.statusMessage),1)])):w("",!0)])}const I=y(F,[["render",A],["__scopeId","data-v-1e970232"]]);export{I as default};
//# sourceMappingURL=FileClassicPage-D21ww8mX.js.map
