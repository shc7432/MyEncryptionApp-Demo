{"version":3,"file":"FilePage-CfNoCBiV.js","sources":["../../src/views/FilePage.vue"],"sourcesContent":["<template>\r\n  <div class=\"file-page\">\r\n    <h2>文件加密/解密</h2>\r\n    \r\n    <div class=\"input-section\">\r\n      <div class=\"file-select-group\">\r\n        <button @click=\"selectFile\" style=\"flex: unset; padding: 10px 20px;\">选择文件</button>\r\n        <div class=\"file-name\">{{ selectedFile?.name || '没有选择文件' }}</div>\r\n      </div>\r\n      <input type=\"password\" v-model=\"password\" placeholder=\"输入密码\">\r\n      \r\n      <div class=\"chunk-size-group\">\r\n        <div class=\"chunk-size-header\">\r\n          <label>分块大小(MiB):</label>\r\n          <input type=\"number\" v-model.number=\"chunkSize\" min=\"1\" max=\"128\">\r\n        </div>\r\n        \r\n        <details class=\"hint-box\" open>\r\n          <summary class=\"hint-title\">分块大小建议:</summary>\r\n          <ul class=\"hint-list\">\r\n            <li><strong>大文件(32MiB)</strong>: 整体文件处理，提高性能</li>\r\n            <li><strong>视频文件(5-32MiB)</strong>: 增强随机读取性能</li>\r\n            <li><strong>一般视频(5MiB)</strong>: 适合大多数视频文件</li>\r\n            <li><strong>较大视频(16-32MiB)</strong>: 适合高清/4K视频</li>\r\n          </ul>\r\n          \r\n          <div class=\"warning-text\">\r\n            ⚠️ 注意: 分块太小会导致文件被分成过多块，可能产生大量请求次数，造成额外费用。\r\n            请根据文件类型和大小选择合适的分块大小。\r\n          </div>\r\n        </details>\r\n      </div>\r\n      \r\n      <div class=\"button-group\" style=\"margin-top: 0.5em;\">\r\n        <button @click=\"encryptFile\" :disabled=\"isLoading\">加密</button>\r\n        <button @click=\"decryptFile\" :disabled=\"isLoading\">解密</button>\r\n        <button @click=\"changePassword\" :disabled=\"isLoading\">改密</button>\r\n        <button @click=\"clearAll\" :disabled=\"isLoading\">清除</button>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"password-change-section\" v-if=\"showPasswordChange\">\r\n      <h3>更改密码</h3>\r\n      <input type=\"password\" v-model=\"newPassword\" placeholder=\"输入新密码\">\r\n      <div class=\"button-group\">\r\n        <button @click=\"confirmPasswordChange\" :disabled=\"isLoading\">确认更改</button>\r\n        <button @click=\"cancelPasswordChange\" :disabled=\"isLoading\">取消</button>\r\n      </div>\r\n    </div>\r\n    \r\n    <div class=\"status-section\" v-if=\"statusMessage\">\r\n      <h3>状态:</h3>\r\n      <div class=\"status-box\">{{ statusMessage }}</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { encrypt_file, decrypt_file, change_file_password } from 'simple-data-crypto/builder'\r\n\r\nexport default {\r\n  name: 'FilePage',\r\n  data() {\r\n    return {\r\n      selectedFileHandle: null,\r\n      selectedFile: null,\r\n      password: '',\r\n      chunkSize: 32, // 默认32MiB\r\n      statusMessage: '',\r\n      isLoading: false,\r\n      showPasswordChange: false,\r\n      newPassword: ''\r\n    }\r\n  },\r\n  methods: {\r\n    async selectFile() {\r\n      try {\r\n        const [fileHandle] = await window.showOpenFilePicker({writable: true, multiple: false});\r\n        this.selectedFileHandle = fileHandle;\r\n        this.selectedFile = await fileHandle.getFile();\r\n        this.statusMessage = `已选择文件: ${this.selectedFile.name}`;\r\n      } catch (error) {\r\n        this.statusMessage = '文件选择取消或出错: ' + error.message;\r\n      }\r\n    },\r\n    async encryptFile() {\r\n      if (!this.selectedFile) {\r\n        this.statusMessage = '请选择文件';\r\n        return;\r\n      }\r\n      if (!this.password) {\r\n        if (!confirm('确定要使用空密码？这非常不安全！')) return;\r\n      }\r\n      \r\n      this.isLoading = true;\r\n      try {\r\n        const encryptedFileName = `${this.selectedFile.name}.enc`;\r\n        const saveHandle = await window.showSaveFilePicker({\r\n          suggestedName: encryptedFileName\r\n        });\r\n        \r\n        const writable = await saveHandle.createWritable();\r\n        const chunkSize = this.chunkSize * 1024 * 1024;\r\n        \r\n        await encrypt_file(\r\n          async (start, end) => {\r\n            const chunk = await this.selectedFile.slice(start, end).arrayBuffer();\r\n            return new Uint8Array(chunk);\r\n          },\r\n          (data) => writable.write(data),\r\n          this.password,\r\n          (progress) => {\r\n            const percent = Number(progress / this.selectedFile.size * 100);\r\n            if (progress >= this.selectedFile.size || percent === 100 || percent.toFixed(2) === '100.00') {\r\n              this.statusMessage = '正在保存文件，请稍候...这可能需要一些时间。';\r\n            } else {\r\n              this.statusMessage = `加密中... ${percent.toFixed(2)}%`;\r\n            }\r\n          },\r\n          null,\r\n          null,\r\n          chunkSize\r\n        );\r\n        \r\n        await writable.close();\r\n        this.statusMessage = `文件加密成功: ${encryptedFileName}`;\r\n      } catch (error) {\r\n        this.statusMessage = '加密失败: ' + error.message;\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    },\r\n    async decryptFile() {\r\n      if (!this.selectedFile) {\r\n        this.statusMessage = '请选择文件';\r\n        return;\r\n      }\r\n      \r\n      this.isLoading = true;\r\n      try {\r\n        const decryptedFileName = this.selectedFile.name.endsWith('.enc') \r\n          ? this.selectedFile.name.slice(0, -4) \r\n          : `decrypted_${this.selectedFile.name}`;\r\n          \r\n        const saveHandle = await window.showSaveFilePicker({\r\n          suggestedName: decryptedFileName\r\n        });\r\n        \r\n        const writable = await saveHandle.createWritable();\r\n        \r\n        await decrypt_file(\r\n          async (start, end) => {\r\n            const chunk = await this.selectedFile.slice(start, end).arrayBuffer();\r\n            return new Uint8Array(chunk);\r\n          },\r\n          (data) => writable.write(data),\r\n          this.password,\r\n          (progress) => {\r\n            const percent = Number(progress / this.selectedFile.size * 100);\r\n            if (progress >= this.selectedFile.size || percent === 100 || percent.toFixed(2) === '100.00') {\r\n              this.statusMessage = '正在保存文件，请稍候...这可能需要一些时间。';\r\n            } else {\r\n              this.statusMessage = `解密中... ${percent.toFixed(2)}%`;\r\n            }\r\n          }\r\n        );\r\n        \r\n        await writable.close();\r\n        this.statusMessage = `文件解密成功: ${decryptedFileName}`;\r\n      } catch (error) {\r\n        this.statusMessage = '解密失败: ' + error.message;\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    },\r\n    clearAll() {\r\n      this.selectedFile = null\r\n      this.password = ''\r\n      this.statusMessage = ''\r\n    },\r\n    changePassword() {\r\n      if (!this.selectedFile) {\r\n        this.statusMessage = '请选择文件';\r\n        return;\r\n      }\r\n      this.showPasswordChange = true;\r\n      this.newPassword = '';\r\n      this.confirmPassword = '';\r\n    },\r\n    \r\n    cancelPasswordChange() {\r\n      this.showPasswordChange = false;\r\n      this.newPassword = '';\r\n      this.confirmPassword = '';\r\n    },\r\n    \r\n    async confirmPasswordChange() {\r\n      if (!this.newPassword) {\r\n        if (!confirm('确定要使用空密码？这非常不安全！')) return;\r\n      }\r\n      \r\n      this.isLoading = true;\r\n      try {\r\n        this.statusMessage = '正在处理...';\r\n        const fileHandle = this.selectedFileHandle;\r\n        \r\n        const file = this.selectedFile;\r\n        const blob = file.slice(0, 5000);\r\n        \r\n        this.statusMessage = '正在更改密码，请稍候...';\r\n        const newFileHead = await change_file_password(blob, this.password, this.newPassword);\r\n        \r\n        this.statusMessage = '正在保存文件，请稍候...这可能需要一些时间。';\r\n        const writable = await fileHandle.createWritable({ keepExistingData: true });\r\n        await writable.write(newFileHead);\r\n        await writable.close();\r\n        \r\n        this.statusMessage = '密码更改成功';\r\n        this.showPasswordChange = false;\r\n        this.newPassword = '';\r\n        this.confirmPassword = '';\r\n      } catch (error) {\r\n        this.statusMessage = '密码更改失败: ' + error.message;\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.file-page {\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n  padding: 10px;\r\n}\r\n\r\n.input-section {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.file-select-group {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.file-name {\r\n  flex: 1;\r\n  white-space: nowrap;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis;\r\n  padding: 10px;\r\n  background: #f9f9f9;\r\n  border-radius: 4px;\r\n}\r\n\r\n.chunk-size-header {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 10px;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.hint-box {\r\n  padding: 15px;\r\n  background: #f8f9fa;\r\n  border-radius: 6px;\r\n  border-left: 4px solid #4a89dc;\r\n}\r\n\r\n.hint-title {\r\n  font-weight: bold;\r\n  margin-bottom: 8px;\r\n  color: #2c3e50;\r\n}\r\n\r\n.hint-list {\r\n  margin: 10px 0;\r\n  padding-left: 20px;\r\n  text-align: left;\r\n}\r\n\r\n.hint-list li {\r\n  margin-bottom: 5px;\r\n  color: #555;\r\n}\r\n\r\n.warning-text {\r\n  margin-top: 10px;\r\n  padding: 10px;\r\n  background: #fff8e1;\r\n  border-radius: 4px;\r\n  color: #e65100;\r\n  font-size: 0.9em;\r\n}\r\n\r\ninput[type=\"file\"] {\r\n  width: 100%;\r\n  margin-bottom: 10px;\r\n}\r\n\r\ninput[type=\"password\"] {\r\n  width: 100%;\r\n  padding: 10px;\r\n  margin-bottom: 10px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 4px;\r\n}\r\n\r\n.button-group {\r\n  display: flex;\r\n  gap: 10px;\r\n}\r\n\r\nbutton {\r\n  flex: 1;\r\n  padding: 10px;\r\n  background: #2c3e50;\r\n  color: white;\r\n  border: none;\r\n  border-radius: 4px;\r\n  cursor: pointer;\r\n}\r\n\r\nbutton:disabled {\r\n  background: #cccccc;\r\n  cursor: not-allowed;\r\n}\r\n\r\nbutton:not(:disabled):hover {\r\n  background: #1a2a3a;\r\n}\r\n\r\n.status-section {\r\n  margin-top: 20px;\r\n}\r\n\r\n.status-box {\r\n  min-height: 50px;\r\n  padding: 10px;\r\n  border: 1px solid #ddd;\r\n  border-radius: 4px;\r\n  background: #f9f9f9;\r\n}\r\n</style>"],"names":["_sfc_main","fileHandle","error","encryptedFileName","writable","chunkSize","encrypt_file","start","end","chunk","data","progress","percent","decryptedFileName","decrypt_file","blob","newFileHead","change_file_password","_hoisted_1","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_17","_openBlock","_createElementBlock","_cache","_createElementVNode","$options","args","_toDisplayString","$data","$event","_createStaticVNode","_hoisted_7","_hoisted_12","_createCommentVNode","_hoisted_16"],"mappings":"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"}