import{c as f,a as g,b as m}from"./main.bundle.builder-GocpWJG2.js";import{_ as p,c as o,a as i,b as h,w as r,t as w,v as c,d as F,o as u}from"./index-fXovao5F.js";const b={name:"FilePage",data(){return{selectedFileHandle:null,selectedFile:null,password:"",chunkSize:32,statusMessage:"",isLoading:!1,showPasswordChange:!1,newPassword:""}},methods:{async selectFile(){try{const[l]=await window.showOpenFilePicker({writable:!0,multiple:!1});this.selectedFileHandle=l,this.selectedFile=await l.getFile(),this.statusMessage=`已选择文件: ${this.selectedFile.name}`}catch(l){this.statusMessage="文件选择取消或出错: "+l}},async encryptFile(){if(!this.selectedFile){this.statusMessage="请选择文件";return}if(!(!this.password&&!confirm("确定要使用空密码？这非常不安全！"))){this.isLoading=!0;try{const l=`${this.selectedFile.name}.enc`,d=await(await window.showSaveFilePicker({suggestedName:l})).createWritable(),n=this.chunkSize*1024*1024;await m(async(e,t)=>{const a=await this.selectedFile.slice(e,t).arrayBuffer();return new Uint8Array(a)},e=>d.write(e),this.password,e=>{const t=Number(e/this.selectedFile.size*100);e>=this.selectedFile.size||t===100||t.toFixed(2)==="100.00"?this.statusMessage="正在保存文件，请稍候...这可能需要一些时间。":this.statusMessage=`加密中... ${t.toFixed(2)}%`},null,null,n),await d.close(),this.statusMessage=`文件加密成功: ${l}`}catch(l){this.statusMessage="加密失败: "+l}finally{this.isLoading=!1}}},async decryptFile(){if(!this.selectedFile){this.statusMessage="请选择文件";return}this.isLoading=!0;try{const l=this.selectedFile.name.endsWith(".enc")?this.selectedFile.name.slice(0,-4):`decrypted_${this.selectedFile.name}`,d=await(await window.showSaveFilePicker({suggestedName:l})).createWritable();await g(async(n,e)=>{const t=await this.selectedFile.slice(n,e).arrayBuffer();return new Uint8Array(t)},n=>d.write(n),this.password,n=>{const e=Number(n/this.selectedFile.size*100);n>=this.selectedFile.size||e===100||e.toFixed(2)==="100.00"?this.statusMessage="正在保存文件，请稍候...这可能需要一些时间。":this.statusMessage=`解密中... ${e.toFixed(2)}%`}),await d.close(),this.statusMessage=`文件解密成功: ${l}`}catch(l){this.statusMessage="解密失败: "+l}finally{this.isLoading=!1}},clearAll(){this.selectedFile=null,this.password="",this.statusMessage=""},changePassword(){if(!this.selectedFile){this.statusMessage="请选择文件";return}this.showPasswordChange=!0,this.newPassword="",this.confirmPassword=""},cancelPasswordChange(){this.showPasswordChange=!1,this.newPassword="",this.confirmPassword=""},async confirmPasswordChange(){if(!(!this.newPassword&&!confirm("确定要使用空密码？这非常不安全！"))){this.isLoading=!0;try{this.statusMessage="正在处理...";const l=this.selectedFileHandle,d=this.selectedFile.slice(0,5e3);this.statusMessage="正在更改密码，请稍候...";const n=await f(d,this.password,this.newPassword);this.statusMessage="正在保存文件，请稍候...这可能需要一些时间。";const e=await l.createWritable({keepExistingData:!0});await e.write(n),await e.close(),this.statusMessage="密码更改成功",this.showPasswordChange=!1,this.newPassword="",this.confirmPassword=""}catch(l){this.statusMessage="密码更改失败: "+l}finally{this.isLoading=!1}}}}},y={class:"file-page"},v={class:"input-section"},P={class:"file-select-group"},M={class:"file-name"},k={class:"chunk-size-group"},_={class:"chunk-size-header"},C={class:"button-group",style:{"margin-top":"0.5em"}},x=["disabled"],L=["disabled"],z=["disabled"],B=["disabled"],H={key:0,class:"password-change-section"},N={class:"button-group"},S=["disabled"],V=["disabled"],A={key:1,class:"status-section"},U={class:"status-box"};function W(l,s,d,n,e,t){return u(),o("div",y,[s[14]||(s[14]=i("h2",null,"文件加密/解密",-1)),i("div",v,[i("div",P,[i("button",{onClick:s[0]||(s[0]=(...a)=>t.selectFile&&t.selectFile(...a)),style:{flex:"unset",padding:"10px 20px"}},"选择文件"),i("div",M,w(e.selectedFile?.name||"没有选择文件"),1)]),r(i("input",{type:"password","onUpdate:modelValue":s[1]||(s[1]=a=>e.password=a),placeholder:"输入密码"},null,512),[[c,e.password]]),i("div",k,[i("div",_,[s[10]||(s[10]=i("label",null,"分块大小(MiB):",-1)),r(i("input",{type:"number","onUpdate:modelValue":s[2]||(s[2]=a=>e.chunkSize=a),min:"1",max:"128"},null,512),[[c,e.chunkSize,void 0,{number:!0}]])]),s[11]||(s[11]=F('<details class="hint-box" open data-v-cdf6f726><summary class="hint-title" data-v-cdf6f726>分块大小建议:</summary><ul class="hint-list" data-v-cdf6f726><li data-v-cdf6f726><strong data-v-cdf6f726>大文件(32MiB)</strong>: 整体文件处理，提高性能</li><li data-v-cdf6f726><strong data-v-cdf6f726>视频文件(5-32MiB)</strong>: 增强随机读取性能</li><li data-v-cdf6f726><strong data-v-cdf6f726>一般视频(5MiB)</strong>: 适合大多数视频文件</li><li data-v-cdf6f726><strong data-v-cdf6f726>较大视频(16-32MiB)</strong>: 适合高清/4K视频</li></ul><div class="warning-text" data-v-cdf6f726> ⚠️ 注意: 分块太小会导致文件被分成过多块，可能产生大量请求次数，造成额外费用。 请根据文件类型和大小选择合适的分块大小。 </div></details>',1))]),i("div",C,[i("button",{onClick:s[3]||(s[3]=(...a)=>t.encryptFile&&t.encryptFile(...a)),disabled:e.isLoading},"加密",8,x),i("button",{onClick:s[4]||(s[4]=(...a)=>t.decryptFile&&t.decryptFile(...a)),disabled:e.isLoading},"解密",8,L),i("button",{onClick:s[5]||(s[5]=(...a)=>t.changePassword&&t.changePassword(...a)),disabled:e.isLoading},"改密",8,z),i("button",{onClick:s[6]||(s[6]=(...a)=>t.clearAll&&t.clearAll(...a)),disabled:e.isLoading},"清除",8,B)])]),e.showPasswordChange?(u(),o("div",H,[s[12]||(s[12]=i("h3",null,"更改密码",-1)),r(i("input",{type:"password","onUpdate:modelValue":s[7]||(s[7]=a=>e.newPassword=a),placeholder:"输入新密码"},null,512),[[c,e.newPassword]]),i("div",N,[i("button",{onClick:s[8]||(s[8]=(...a)=>t.confirmPasswordChange&&t.confirmPasswordChange(...a)),disabled:e.isLoading},"确认更改",8,S),i("button",{onClick:s[9]||(s[9]=(...a)=>t.cancelPasswordChange&&t.cancelPasswordChange(...a)),disabled:e.isLoading},"取消",8,V)])])):h("",!0),e.statusMessage?(u(),o("div",A,[s[13]||(s[13]=i("h3",null,"状态:",-1)),i("div",U,w(e.statusMessage),1)])):h("",!0)])}const I=p(b,[["render",W],["__scopeId","data-v-cdf6f726"]]);export{I as default};
//# sourceMappingURL=FilePage-CvuPeOnf.js.map
