import{c as g,a as f,b as m}from"./main.bundle.builder-C2m_JIdm.js";import{_ as F,c as r,a as l,b as h,w as o,t as w,v as c,d as p,o as u}from"./index-CGD7C7pN.js";const y={name:"FilePage",data(){return{selectedFileHandle:null,selectedFile:null,password:"",chunkSize:32,statusMessage:"",isLoading:!1,showPasswordChange:!1,newPassword:""}},methods:{async selectFile(){try{const[t]=await window.showOpenFilePicker({writable:!0,multiple:!1});this.selectedFileHandle=t,this.selectedFile=await t.getFile(),this.statusMessage=`已选择文件: ${this.selectedFile.name}`}catch(t){this.statusMessage="文件选择取消或出错: "+t}},async encryptFile(){if(!this.selectedFile){this.statusMessage="请选择文件";return}if(!(!this.password&&!confirm("确定要使用空密码？这非常不安全！"))){this.isLoading=!0;try{const t=`${this.selectedFile.name}.enc`,d=await(await window.showSaveFilePicker({suggestedName:t})).createWritable(),n=this.chunkSize*1024*1024;await m(async(s,i)=>{const a=await this.selectedFile.slice(s,i).arrayBuffer();return new Uint8Array(a)},s=>d.write(s),this.password,s=>{const i=Number(s/this.selectedFile.size*100);s>=this.selectedFile.size||i===100||i.toFixed(2)==="100.00"?this.statusMessage="正在保存文件，请稍候...这可能需要一些时间。":this.statusMessage=`加密中... ${i.toFixed(2)}%`},null,null,n),await d.close(),this.statusMessage=`文件加密成功: ${t}`}catch(t){this.statusMessage="加密失败: "+t}finally{this.isLoading=!1}}},async decryptFile(){if(!this.selectedFile){this.statusMessage="请选择文件";return}this.isLoading=!0;try{const t=this.selectedFile.name.endsWith(".enc")?this.selectedFile.name.slice(0,-4):`decrypted_${this.selectedFile.name}`,d=await(await window.showSaveFilePicker({suggestedName:t})).createWritable();await f(async(n,s)=>{const i=await this.selectedFile.slice(n,s).arrayBuffer();return new Uint8Array(i)},n=>d.write(n),this.password,n=>{const s=Number(n/this.selectedFile.size*100);n>=this.selectedFile.size||s===100||s.toFixed(2)==="100.00"?this.statusMessage="正在保存文件，请稍候...这可能需要一些时间。":this.statusMessage=`解密中... ${s.toFixed(2)}%`}),await d.close(),this.statusMessage=`文件解密成功: ${t}`}catch(t){this.statusMessage="解密失败: "+t}finally{this.isLoading=!1}},clearAll(){this.selectedFile=null,this.password="",this.statusMessage=""},changePassword(){if(!this.selectedFile){this.statusMessage="请选择文件";return}this.showPasswordChange=!0,this.newPassword="",this.confirmPassword=""},cancelPasswordChange(){this.showPasswordChange=!1,this.newPassword="",this.confirmPassword=""},async confirmPasswordChange(){if(!(!this.newPassword&&!confirm("确定要使用空密码？这非常不安全！"))){this.isLoading=!0;try{this.statusMessage="正在处理...";const t=this.selectedFileHandle,d=this.selectedFile.slice(0,5e3);this.statusMessage="正在更改密码，请稍候...";const n=await g(d,this.password,this.newPassword);this.statusMessage="正在保存文件，请稍候...这可能需要一些时间。";const s=await t.createWritable({keepExistingData:!0});await s.write(n),await s.close(),this.statusMessage="密码更改成功",this.showPasswordChange=!1,this.newPassword="",this.confirmPassword=""}catch(t){this.statusMessage="密码更改失败: "+t}finally{this.isLoading=!1}}},handleDragOver(t){!t.dataTransfer.items.length||t.dataTransfer.items[0].kind!=="file"||(t.preventDefault(),t.dataTransfer.dropEffect="link")},handleDrop(t){if(!(!t.dataTransfer.items.length||t.dataTransfer.items[0].kind!=="file")){if(t.preventDefault(),t.dataTransfer.items.length>1){this.statusMessage="文件过多。一次只能处理一个文件。";return}queueMicrotask(async()=>{if(this.selectedFileHandle=await t.dataTransfer.items[0].getAsFileSystemHandle(),!(this.selectedFileHandle instanceof FileSystemFileHandle)){this.statusMessage="不支持选择文件夹",this.selectedFile=null;return}this.selectedFile=await this.selectedFileHandle.getFile(),this.statusMessage=`已选择文件: ${this.selectedFileHandle.name}`})}}}},b={class:"input-section"},v={class:"file-select-group"},M={class:"file-name"},P={class:"chunk-size-group"},k={class:"chunk-size-header"},C={class:"button-group",style:{"margin-top":"0.5em"}},x=["disabled"],H=["disabled"],_=["disabled"],D=["disabled"],L={key:0,class:"password-change-section"},z={class:"button-group"},S=["disabled"],B=["disabled"],N={key:1,class:"status-section"},T={class:"status-box"};function A(t,e,d,n,s,i){return u(),r("div",{class:"file-page",onDragoverCapture:e[10]||(e[10]=(...a)=>i.handleDragOver&&i.handleDragOver(...a)),onDrop:e[11]||(e[11]=(...a)=>i.handleDrop&&i.handleDrop(...a))},[e[16]||(e[16]=l("h2",null,"文件加密/解密",-1)),l("div",b,[l("div",v,[l("button",{onClick:e[0]||(e[0]=(...a)=>i.selectFile&&i.selectFile(...a)),style:{flex:"unset",padding:"10px 20px"}},"选择或拖拽文件"),l("div",M,w(s.selectedFile?.name||"没有选择文件"),1)]),o(l("input",{autocomplete:"off",type:"password","onUpdate:modelValue":e[1]||(e[1]=a=>s.password=a),placeholder:"输入密码"},null,512),[[c,s.password]]),l("div",P,[l("div",k,[e[12]||(e[12]=l("label",null,"分块大小(MiB):",-1)),o(l("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=a=>s.chunkSize=a),min:"1",max:"128"},null,512),[[c,s.chunkSize,void 0,{number:!0}]])]),e[13]||(e[13]=p('<details class="hint-box" open data-v-72156c54><summary class="hint-title" data-v-72156c54>分块大小建议:</summary><ul class="hint-list" data-v-72156c54><li data-v-72156c54><strong data-v-72156c54>大文件(32MiB)</strong>: 整体文件处理，提高性能</li><li data-v-72156c54><strong data-v-72156c54>视频文件(5-32MiB)</strong>: 增强随机读取性能</li><li data-v-72156c54><strong data-v-72156c54>一般视频(5MiB)</strong>: 适合大多数视频文件</li><li data-v-72156c54><strong data-v-72156c54>较大视频(16-32MiB)</strong>: 适合高清/4K视频</li></ul><div class="warning-text" data-v-72156c54> ⚠️ 注意: 分块太小会导致文件被分成过多块，可能产生大量请求次数，造成额外费用。 请根据文件类型和大小选择合适的分块大小。 </div></details>',1))]),l("div",C,[l("button",{onClick:e[3]||(e[3]=(...a)=>i.encryptFile&&i.encryptFile(...a)),disabled:s.isLoading},"加密",8,x),l("button",{onClick:e[4]||(e[4]=(...a)=>i.decryptFile&&i.decryptFile(...a)),disabled:s.isLoading},"解密",8,H),l("button",{onClick:e[5]||(e[5]=(...a)=>i.changePassword&&i.changePassword(...a)),disabled:s.isLoading},"改密",8,_),l("button",{onClick:e[6]||(e[6]=(...a)=>i.clearAll&&i.clearAll(...a)),disabled:s.isLoading},"清除",8,D)])]),s.showPasswordChange?(u(),r("div",L,[e[14]||(e[14]=l("h3",null,"更改密码",-1)),o(l("input",{autocomplete:"off",type:"password","onUpdate:modelValue":e[7]||(e[7]=a=>s.newPassword=a),placeholder:"输入新密码"},null,512),[[c,s.newPassword]]),l("div",z,[l("button",{onClick:e[8]||(e[8]=(...a)=>i.confirmPasswordChange&&i.confirmPasswordChange(...a)),disabled:s.isLoading},"确认更改",8,S),l("button",{onClick:e[9]||(e[9]=(...a)=>i.cancelPasswordChange&&i.cancelPasswordChange(...a)),disabled:s.isLoading},"取消",8,B)])])):h("",!0),s.statusMessage?(u(),r("div",N,[e[15]||(e[15]=l("h3",null,"状态:",-1)),l("div",T,w(s.statusMessage),1)])):h("",!0)],32)}const O=F(y,[["render",A],["__scopeId","data-v-72156c54"]]);export{O as default};
//# sourceMappingURL=FilePage-Z90M0jIs.js.map
