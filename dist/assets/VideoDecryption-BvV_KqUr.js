import{f as g,g as w,h as x,I as v,i as b}from"./main.bundle.builder-GocpWJG2.js";import{P as U}from"./play_video-BFGyulc6.js";import{_ as V,c as d,a as s,b as f,w as u,e as y,f as m,v as h,o as c}from"./index-fXovao5F.js";const D={name:"VideoDecryption",data(){return{ctx:null,file:null,fileUrl:"",password:"",playing:!1,cleanup:null,mode:"local"}},methods:{async getFileSize(i){const e=new AbortController,n=await fetch(i,{signal:e.signal});if(!n.ok)throw new Error(`Failed to fetch file size: ${n.statusText}`);const a=+n.headers.get("Content-Length");if(isNaN(a))throw new Error("Content-Length header is missing or invalid");return e.abort(),a},async playVideo(){if(this.file=this.$refs.filebox.value?.[0],!this.file&&this.mode==="local"){alert("请选择一个视频文件");return}try{this.playing=!0,await this.$nextTick();const i=await w();this.ctx=i;let e=this.mode==="local"?this.file:{size:await this.getFileSize(this.fileUrl)};const n=this.mode==="local"?async(o,t)=>{const r=e.slice(o,t);return new Uint8Array(await r.arrayBuffer())}:async(o,t,r)=>{const p=await fetch(this.fileUrl,{headers:{Range:`bytes=${o}-${t-1}`},method:"GET",signal:r});return new Uint8Array(await p.arrayBuffer())},a=this.password;await x(i,new v((o,t,r)=>n(o,t,r),e.size),a);const l=this.$refs.videoPlayer;l.controls=!0,l.playsInline=!0,this.cleanup=await U(l,async(o,t,r)=>await b(i,o,t,r)),this.$refs.videoDialog.showModal()}catch(i){console.error(i),alert(i),this.playing=!1}},closeDialog(){this.$refs.videoDialog.close()},handleDialogClose(){this.playing=!1,this.cleanup&&(this.cleanup(),this.cleanup=null),g(this.ctx),this.ctx=null}}},C={class:"video-decrypt-container"},k={class:"mode-selector"},_={key:0,type:"file",ref:"filebox"},z=["disabled"],B={key:0,ref:"videoPlayer",controls:"",style:{flex:"1"}};function N(i,e,n,a,l,o){return c(),d("div",C,[s("div",k,[s("label",null,[u(s("input",{type:"radio","onUpdate:modelValue":e[0]||(e[0]=t=>l.mode=t),value:"local"},null,512),[[m,l.mode]]),e[7]||(e[7]=y(" 本地文件 "))]),s("label",null,[u(s("input",{type:"radio","onUpdate:modelValue":e[1]||(e[1]=t=>l.mode=t),value:"remote"},null,512),[[m,l.mode]]),e[8]||(e[8]=y(" 在线文件 "))])]),l.mode==="local"?(c(),d("input",_,null,512)):f("",!0),l.mode==="remote"?u((c(),d("input",{key:1,type:"text","onUpdate:modelValue":e[2]||(e[2]=t=>l.fileUrl=t),placeholder:"输入视频URL"},null,512)),[[h,l.fileUrl]]):f("",!0),u(s("input",{type:"password","onUpdate:modelValue":e[3]||(e[3]=t=>l.password=t),placeholder:"输入解密密码"},null,512),[[h,l.password]]),s("button",{onClick:e[4]||(e[4]=(...t)=>o.playVideo&&o.playVideo(...t)),disabled:l.mode==="local"||!l.fileUrl&&l.mode==="remote"||l.playing},"播放视频",8,z),s("dialog",{style:{width:"100%",height:"100%",display:"flex","flex-direction":"column"},ref:"videoDialog",onClose:e[6]||(e[6]=(...t)=>o.handleDialogClose&&o.handleDialogClose(...t))},[l.playing?(c(),d("video",B,null,512)):f("",!0),s("button",{onClick:e[5]||(e[5]=(...t)=>o.closeDialog&&o.closeDialog(...t)),style:{"margin-top":"0.5em"}},"关闭")],544)])}const L=V(D,[["render",N],["__scopeId","data-v-6594b9c9"]]);export{L as default};
//# sourceMappingURL=VideoDecryption-BvV_KqUr.js.map
